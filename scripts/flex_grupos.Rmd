---
title: "Margaret"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(here)
library(DT)
library(plotly)
library(readxl)
library(shiny)
```

```{r global}
articulos_unicos_2016_2020 <- 
  read_csv(here("data",
                "articulos_unicos.csv")) |> 
  filter(ano >= 2016,
         ano <=2020)

grupos_general <- 
  read_csv(here("output",
                "general_grupos.csv"))

investigadores_general <- 
  read_csv(here("output", 
                "df_researcher.csv"))

grupos_inves <-
  read_csv(here("data",
                "grupos.csv"))

```


# General

## Column {.tabset}

### Grupos

```{r}
grupos_general |> 
  datatable(options = list(pageLength = 15),
            escape = FALSE)
```

### Investigadores

```{r}
investigadores_general |> 
  mutate(url = str_c("<a href=","\"",
                     url,
                     "\"",
                     ">Link</a>"),
         scholar = str_c("<a href=","\"",
                         "https://scholar.google.com/citations?user=",
                         id_scholar,
                         "\"",
                         ">Scholar</a>")) |>
  select(-vinculacion,
         -fin_vinculacion) |> 
  rename(Investigador = integrantes,
         Categoria = categoria,
         Produccion = cantidad,
         Horas = horas_dedicacion,
         CvLAC = url,
         Grupo = grupo,
         Inicio = inicio_vinculacion,
         Formacion = ultima_formacion_academica,
         ) |> 
  select(Investigador,
         Categoria,
         Produccion,
         h_index,
         Formacion,
         Grupo,
         Inicio,
         CvLAC,
         scholar) |> 
  datatable(options = list(pageLength = 10),
            escape = FALSE)
```

### Paises
```{r}
articulos_unicos_2016_2020 |> 
  count(pais_revista, sort = TRUE) |> 
  datatable(options = list(pageLength = 10))
```
### Revistas
```{r}
articulos_unicos_2016_2020 |> 
  count(revista, sort = TRUE) |> 
  datatable(options = list(pageLength = 10))
```

# Grupos - General

## column {.tabset}
```{r}
data1 <- grupos_inves |> count(clasificacion) |> arrange(desc(clasificacion))
fig1 <- plot_ly(data1, labels = ~clasificacion, values = ~n, type = 'pie')
fig1 <- fig1 %>% layout(title = 'Clasificacion grupos de investigacion',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))
fig1
```

## column {.tabset}
```{r}
data2 <- grupos_inves |> 
  count(area_conocimiento_1, sort = TRUE, name = "cantidad")
data2[3,1] = "ingenieria y tecnologia"
fig2 <- plot_ly(data2, x = ~area_conocimiento_1, y = ~cantidad, type = 'bar')
fig2 <- fig2 %>% layout(title = "Grupos segun area de conocimiento",
         xaxis = list(title = ""),
         yaxis = list(title = ""))
fig2
```






# Productos General

```{r}
articulos_unicos_2016_2020 |>
  select(-id) |> 
  datatable(options = list(pageLength = 10))
```
